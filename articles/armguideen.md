---
title: Azure Marketplace ARM Creating Guide | Azure
description: Azure Marketplace ARM Creating Guide
services: 
author: siwlv
manager: wayi
ms.assetid: 
ms.service: multiple
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: articles
ms.date: 04/18/2018
ms.author: siwlv
---

# Azure Marketplace ARM Creating Guide
> [!div class="op_single_selector"]
> * [Chinese](https://docs.azure.cn/zh-cn/articles/azure-marketplace/armguide)
> * [English](https://docs.azure.cn/en-us/articles/azure-marketplace/armguide)
This guide introduces the ISVs of Azure Marketplace in China on the main process of creating, uploading ARM template to Azure and testing preparation before publishing.

The scope of **Azure Marketplace** in this article is all in mainland China.

## Pre-requisites for creating a ARM template

### Download needed tools & applications
The following tools should be prepared before the start:

 - You may use test or deployment tool PowerShell, please refer to [How to install and configure Azure PowerShell](https://docs.azure.cn/powershell-install-configure).
 - Create and develop ARM templates usually through Visual Studio. For ARM template development tools, please refer to [Create and deploy Azure resource groups through Visual Studio](https://docs.azure.cn/azure-resource-manager/vs-azure-tools-resource-groups-deployment-projects-create-deploy) and [Use Visual Studio Code extension to create Azure Resource Manager template](https://docs.azure.cn/azure-resource-manager/resource-manager-vscode-extension).
 - For simple ARM, it can also be developed directly with a text editor.

### ARM knowledge and reference
For ARM overview please refer to [Azure Resource Manager overview](https://docs.azure.cn/azure-resource-manager/resource-group-overview).

For the introductory development of ARM templates, it is recommended to refer to and practice [Create and deploy your first Azure Resource Manager template](https://docs.azure.cn/azure-resource-manager/resource-manager-create-first-template) and [Understand the structure and syntax of Azure Resource Manager templates](https://docs.azure.cn/azure-resource-manager/resource-group-authoring-templates). 

### Resources of reference sample
[Azure Quickstart Templates samples](https://azure.microsoft.com/resources/templates/) and [Documentation of Azure Quickstart Templates samples](https://github.com/azure/azure-quickstart-templates). Please note that if the PowerShell script downloaded from the website to the local area cannot be executed, it may be due to the Windows security isolation. In the properties page of the script file, select "unblock" to unlock the file and execute it again. 

## Special attention to ARM template development
There are some areas that need special attention during the development of the ARM template. Please refer to the following for details: 

### 1. API version list

 For resources API related information, please refer to [Define resources in Azure Resource Manager templates](https://docs.microsoft.com/azure/templates/).  You can see the resource API information of Reference node in the following figure. 

![ARM 资源](https://i.imgur.com/X9uQdmj.png)

 Since the version of the resource API will be in the process of dynamic update, generally we need to use its latest version. You can manually check the version number of the resource in the Azure portal(All services->Resource Explorer), as shown in the following figure. 

![Resource Explorer](https://i.imgur.com/sIl8jbr.png)

At the same time, we recommend that you can get the latest API Version information dynamically by using the resource function, please refer to [用于 Azure Resource Manager 模板的 providers 资源函数](https://docs.azure.cn/azure-resource-manager/resource-group-template-functions-resource#providers). For example, for API version of storage account, we can get the following methods：

	"apiVersion": "[providers('Microsoft.Storage','storageAccounts').apiVersions[0]]"


### 2. Login authentication method of VM
In addition to the username-password mode of VM login, it is strongly recommended to support the way of certificate and SSH key login. Please refer to part of **certificate** and **osProfile** of [Azure virtual machine scale sets FAQs](https://docs.azure.cn/virtual-machine-scale-sets/virtual-machine-scale-sets-faq) and example [101-vm-sshkey GitHub QuickStart Template](https://github.com/Azure/azure-quickstart-templates/blob/master/101-vm-sshkey/azuredeploy.json). 

### 3. Resource dependency.
Since the ARM template is resource-centric, you need to pay special attention to the dependencies between resources and understand the sequence of the processes generated by these resources. For example, in the following example, you can set up ARM for WebSite in Azure (refer to the use case Wordpress ARM template in Azure Portal).  
	
	The connection test process (type "config") dependsOn PHP configuration (type "config"); PHP configuring dependsOn php software installation (type "extensions"); php software installation depends on the site (type "Microsoft.Web/sites/").
	Without a strict relationship definition of resource dependence, the creation of WebSite can sometimes be successful, but it is not stable and often fails, and it is difficult to find the cause.

 How to use a dependency relationship, please refer to [Conditionally deploy a resource in an Azure Resource Manager template](https://docs.azure.cn/azure-resource-manager/resource-group-define-dependencies).

### 4. Extensions issues
ARM often needs to use the Extensions script. Because the Extensions script is executed when the virtual machine is created, the script usually needs to be downloaded and executed over the network. If the script is placed on an external network (such as Github), download failure or slow situation often occur in practice. Therefore, we recommend putting scripts on the Azure cloud platform.

### 5. VHD reference
If you need to reference VHD image in your ARM template, you first need to publish this image on the [Azure Marketplace Publishing Platform](https://market-publish.azure.cn/)(Hide release, the image is only published but not shown in Azure Portal). After the image is published successfully, you need to obtain the published image information from the Azure Marketplace support staff. The following four items need to be used in the template and referenced in ARM.
	"storageProfile": {
    	"imageReference": {
       		"publisher": "abcpublisher",
       		"offer": "abcimage",
       		"sku": "standard",
       		"version": "latest"
    	}
	}

 For ARM template parameters, please refer to [ARM template parameters](https://docs.azure.cn/azure-resource-manager/resource-manager-templates-parameters). 


## ARM template testing deployed to Azure platform
Under PowerShell, login to Azure platform in ARM mode and deploy ARM template. For detailed ARM deployment and test methods, please refer to [Deploy resources with ARM templates and Azure PowerShell](https://docs.azure.cn/azure-resource-manager/resource-group-template-deploy).
